"use strict";(self["webpackChunkvue2_7"]=self["webpackChunkvue2_7"]||[]).push([[109],{7109:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"room"},[t("van-field",{staticClass:"top",attrs:{center:"",clearable:"",label:"链接",placeholder:"输入链接","label-width":"0.8rem"},scopedSlots:e._u([{key:"button",fn:function(){return[t("van-button",{attrs:{size:"small",type:"primary"},on:{click:e.reset}},[e._v("设置链接")])]},proxy:!0}]),model:{value:e.url,callback:function(t){e.url=t},expression:"url"}}),t("div",{staticClass:"listBox"},e._l(e.list,(function(s,o){return t("div",{key:o},[t("span",[e._v(e._s("system"==s.type?"系统":s.nickname)+":")]),e._v(e._s(s.data))])})),0),t("van-field",{staticClass:"bottom",attrs:{center:"",clearable:"",placeholder:"输入你想说的话"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendWord.apply(null,arguments)}},scopedSlots:e._u([{key:"button",fn:function(){return[t("van-button",{attrs:{size:"small",type:"primary"},on:{click:e.sendWord}},[e._v("发送")])]},proxy:!0}]),model:{value:e.word,callback:function(t){e.word=t},expression:"word"}})],1)},n=[],i={data(){return{url:"localhost:8000",websocket:null,list:[],timer:null,word:"",name:"",isOpen:!1}},mounted(){this.name="游客"+((new Date).getTime()+"").slice(-4),this.openWebsocket()},destroyed(){this.closeWebsocket()},methods:{sendWord(){this.sendMeg({type:"say",data:this.word,nickname:this.name}),this.word=""},closeWebsocket(){this.websocket.close(),clearInterval(this.timer),this.timer=null},reset(){this.closeWebsocket(),setTimeout((()=>{this.$toast.loading({message:"重连中...",forbidClick:!0}),setTimeout((()=>{this.openWebsocket(),this.$toast.clear()}),2e3)}),2e3)},sendMeg(e){this.isOpen?this.websocket.send(JSON.stringify(e)):this.$toast("websocket已关闭,请刷新页面")},openWebsocket(){if("undefined"===typeof WebSocket)this.$toast("您的浏览器不支持websocket");else{let e="https:"==window.location.protocol?"wss":"ws",t=`${e}://`+this.url;this.websocket=new WebSocket(t),this.websocket.onopen=()=>{this.$toast("创建websocket成功"),this.isOpen=!0,this.sendMeg({nickname:this.name,type:"login"}),this.timer=setInterval((()=>{this.sendMeg({type:"ping"})}),5e3)},this.websocket.onmessage=e=>{let t=JSON.parse(e.data);"pong"!=t.type&&this.list.push(JSON.parse(e.data))},this.websocket.onerror=e=>{console.log("websocket错误：",e),this.$toast("websocket错误"),clearInterval(this.timer),this.timer=null},this.websocket.onclose=e=>{console.log("websocket关闭：",e),this.isOpen=!1,this.$toast("websocket关闭了"),clearInterval(this.timer),this.timer=null}}}}},l=i,a=s(1001),r=(0,a.Z)(l,o,n,!1,null,null,null),c=r.exports}}]);